<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SolutionHub ‚Ä¢ Verified Experts</title>

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- üí≥ Razorpay Checkout Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
:root{
  --bg:#0a0c1a;
  --card:#111827;
  --glass:rgba(255,255,255,0.03);
  --border:rgba(255,255,255,0.08);
  --text:#f8fafc;
  --muted:#cbd5e1;
  --accent:#6366f1;
  --success:#10b981;
  --warning:#f59e0b;
  --radius:20px;
  --shadow:0 25px 60px rgba(0,0,0,.45);
  --gradient:linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:"Plus Jakarta Sans",sans-serif;
  background:linear-gradient(145deg, var(--bg) 0%, #020617 100%);
  color:var(--text);
  min-height:100vh;
}

header{
  position:sticky;
  top:0;
  z-index:100;
  background:rgba(10,12,26,.95);
  backdrop-filter:blur(25px);
  border-bottom:1px solid var(--border);
}

.header-inner{
  max-width:1400px;
  margin:auto;
  padding:20px 32px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.brand{
  font-size:28px;
  font-weight:800;
  background:var(--gradient);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  cursor:pointer;
}

.nav{
  display:flex;
  gap:20px;
  align-items:center;
}

.nav a{
  text-decoration:none;
  color:var(--muted);
  font-weight:600;
  transition:all .3s ease;
  font-size:15px;
}

.nav a:hover{ color:var(--text); }

.nav .cta{
  background:var(--gradient);
  color:white;
  padding:12px 24px;
  border-radius:16px;
  font-weight:700;
  box-shadow:0 8px 25px rgba(99,102,241,.3);
}

.nav span{
  color:var(--text);
  font-weight:600;
  font-size:14px;
  padding:8px 16px;
  background:var(--glass);
  border-radius:12px;
  border:1px solid var(--border);
}

.hero{
  text-align:center;
  padding:80px 20px 60px;
}

.hero h1{
  font-size:48px;
  font-weight:800;
  line-height:1.1;
  margin-bottom:20px;
}

.hero p{
  max-width:700px;
  margin:0 auto 40px;
  color:var(--muted);
  font-size:20px;
}

.filters{
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
  margin:40px auto 60px;
  max-width:900px;
  padding:0 20px;
}

.filters button{
  padding:14px 24px;
  border-radius:16px;
  background:var(--glass);
  border:1px solid var(--border);
  color:var(--muted);
  cursor:pointer;
  font-weight:600;
  backdrop-filter:blur(10px);
  transition:all .3s ease;
  font-size:14px;
}

.filters button.active,
.filters button:hover{
  background:var(--gradient);
  color:white;
  border-color:transparent;
  transform:translateY(-2px);
}

.grid{
  max-width:1400px;
  margin:auto;
  padding:0 32px 100px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(420px,1fr));
  gap:32px;
}

.card{
  background:var(--glass);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
  transition:all .4s cubic-bezier(0.4,0,0.2,1);
  position:relative;
}

.card:hover{
  transform:translateY(-12px);
  box-shadow:var(--shadow);
  border-color:rgba(99,102,241,.3);
}

/* Enhanced Card Header with Larger Photo */
.card-header{
  padding:32px 28px 24px;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  background:linear-gradient(180deg, rgba(99,102,241,0.1) 0%, transparent 100%);
  border-bottom:1px solid var(--border);
}

.avatar-container{
  position:relative;
  width:120px;
  height:120px;
  margin-bottom:16px;
}

.avatar{
  width:100%;
  height:100%;
  border-radius:50%;
  object-fit:cover;
  border:5px solid rgba(99,102,241,.4);
  display:block;
  box-shadow:0 8px 25px rgba(0,0,0,.3);
}

.avatar-fallback{
  width:100%;
  height:100%;
  border-radius:50%;
  background:var(--gradient);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:48px;
  font-weight:800;
  color:white;
  box-shadow:0 8px 25px rgba(0,0,0,.3);
}

/* Verified Badge on Avatar */
.verified-badge{
  position:absolute;
  bottom:5px;
  right:5px;
  width:32px;
  height:32px;
  background:var(--success);
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  border:3px solid var(--card);
  box-shadow:0 2px 10px rgba(16,185,129,.5);
}

.verified-badge i{
  color:white;
  font-size:14px;
}

.card-content{
  width:100%;
}

.card-content h3{
  font-size:24px;
  font-weight:800;
  margin-bottom:8px;
  color:var(--text);
}

/* Domain Tag - More Prominent */
.domain{
  display:inline-flex;
  align-items:center;
  gap:6px;
  color:white;
  font-weight:700;
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:1.2px;
  padding:8px 16px;
  border-radius:20px;
  background:var(--gradient);
  box-shadow:0 4px 15px rgba(99,102,241,.3);
  margin-bottom:12px;
}

.status-badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 14px;
  border-radius:20px;
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  margin-left:8px;
}

.status-approved{ 
  background:rgba(16,185,129,.15); 
  color:var(--success);
  border:1px solid rgba(16,185,129,.3);
}

.status-pending{ 
  background:rgba(245,158,11,.15); 
  color:var(--warning);
  border:1px solid rgba(245,158,11,.3);
}

/* Expert Bio Section */
.expert-bio{
  padding:24px 28px;
}

.headline{
  font-size:16px;
  font-weight:700;
  color:var(--text);
  margin-bottom:12px;
  line-height:1.5;
}

.desc{
  color:var(--muted);
  line-height:1.7;
  font-size:14px;
  margin-bottom:20px;
  display:-webkit-box;
  -webkit-line-clamp:3;
  -webkit-box-orient:vertical;
  overflow:hidden;
}

/* Enhanced Stats Grid */
.stats{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:0 28px 20px;
}

.stat-item{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px;
  background:var(--glass);
  border-radius:12px;
  border:1px solid var(--border);
}

.stat-icon{
  width:36px;
  height:36px;
  border-radius:10px;
  background:var(--gradient);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}

.stat-icon i{
  color:white;
  font-size:16px;
}

.stat-info{
  flex:1;
}

.stat-label{
  font-size:11px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.5px;
  font-weight:600;
}

.stat-value{
  font-size:16px;
  font-weight:800;
  color:var(--text);
  margin-top:2px;
}

/* LinkedIn Link */
.expert-links{
  padding:0 28px 20px;
  display:flex;
  gap:12px;
}

.linkedin-link{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 16px;
  background:rgba(10,102,194,.15);
  border:1px solid rgba(10,102,194,.3);
  border-radius:12px;
  color:#0a66c2;
  text-decoration:none;
  font-weight:600;
  font-size:13px;
  transition:all .3s ease;
}

.linkedin-link:hover{
  background:rgba(10,102,194,.25);
  transform:translateX(3px);
}

.linkedin-link i{
  font-size:16px;
}

/* üí≥ Price Badge - Enhanced */
.price-section{
  padding:0 28px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.price-badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:12px 20px;
  border-radius:16px;
  font-size:20px;
  font-weight:800;
  background:linear-gradient(135deg, #10b981 0%, #059669 100%);
  color:white;
  box-shadow:0 4px 20px rgba(16,185,129,.4);
}

.price-badge i{
  font-size:16px;
}

.price-label{
  font-size:12px;
  color:var(--muted);
  font-weight:600;
}

.connect{
  width:calc(100% - 56px);
  margin:0 28px 28px;
  background:var(--gradient);
  border:none;
  padding:18px;
  border-radius:16px;
  color:white;
  font-weight:700;
  font-size:16px;
  cursor:pointer;
  transition:all .3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  box-shadow:0 8px 25px rgba(99,102,241,.4);
}

.connect:hover{
  transform:translateY(-3px);
  box-shadow:0 15px 40px rgba(99,102,241,.6);
}

.connect:disabled{
  opacity:0.6;
  cursor:not-allowed;
  transform:none;
}

.empty{
  grid-column:1/-1;
  text-align:center;
  color:var(--muted);
  padding:80px 20px;
}

.empty i{ 
  font-size:80px; 
  opacity:.3; 
  margin-bottom:24px; 
  display:block; 
}

.empty h3{
  font-size:24px;
  margin-bottom:12px;
  color:var(--text);
}

/* üí≥ Payment Processing Modal */
.payment-modal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  backdrop-filter:blur(15px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
  animation:fadeIn 0.3s ease;
}

.payment-modal.active{
  display:flex;
}

.payment-content{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:24px;
  padding:50px 40px;
  max-width:500px;
  width:90%;
  text-align:center;
  animation:slideUp 0.3s ease;
}

.payment-content i.fa-spinner{
  font-size:56px;
  color:var(--accent);
  margin-bottom:24px;
  animation:spin 1s linear infinite;
}

.payment-content h3{
  font-size:24px;
  margin-bottom:12px;
  color:var(--text);
}

.payment-content p{
  color:var(--muted);
  font-size:15px;
}

@keyframes fadeIn{
  from{ opacity:0; }
  to{ opacity:1; }
}

@keyframes slideUp{
  from{ transform:translateY(30px); opacity:0; }
  to{ transform:translateY(0); opacity:1; }
}

@keyframes spin{
  from{ transform:rotate(0deg); }
  to{ transform:rotate(360deg); }
}

footer{
  border-top:1px solid var(--border);
  padding:40px 20px;
  text-align:center;
  color:var(--muted);
  font-size:14px;
}

@media (max-width:768px){
  .grid{ 
    grid-template-columns:1fr; 
    padding:0 16px 60px; 
  }
  .hero h1{ font-size:32px; }
  .hero{ padding:60px 20px 40px; }
  .filters{ 
    flex-direction:column; 
    align-items:stretch; 
    max-width:300px;
  }
  .filters button{ width:100%; }
  .nav span{ display:none; }
  .stats{ grid-template-columns:1fr; }
}
</style>
</head>

<body>
<header>
  <div class="header-inner">
    <div class="brand" onclick="location.href='/experts.html'">SolutionHub</div>
    <nav class="nav" id="nav"></nav>
  </div>
</header>

<section class="hero">
  <h1>Connect with <span style="background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">Verified Experts</span></h1>
  <p>Real professionals ready to help you succeed</p>
</section>

<section class="filters">
  <button class="active" onclick="filterExperts('all', this)">All Experts</button>
  <button onclick="filterExperts('programming', this)">Programming</button>
  <button onclick="filterExperts('devops', this)">DevOps</button>
  <button onclick="filterExperts('academics', this)">Academics</button>
  <button onclick="filterExperts('career', this)">Career</button>
  <button onclick="filterExperts('business', this)">Business</button>
</section>

<section class="grid" id="expertsGrid">
  <div class="empty">
    <i class="fas fa-spinner fa-spin"></i>
    <h3>Loading experts...</h3>
  </div>
</section>

<!-- üí≥ Payment Processing Modal -->
<div class="payment-modal" id="paymentModal">
  <div class="payment-content">
    <i class="fas fa-spinner fa-spin"></i>
    <h3>Processing Payment...</h3>
    <p style="margin-top:12px;">Please wait while we process your request</p>
  </div>
</div>

<footer>¬© 2026 SolutionHub ‚Ä¢ Empowering Professionals</footer>

<script>
/* ================= CONFIG ================= */
const API_BASE_URL = 'http://localhost:3000/api';

const EXPERT_PRICING = {
  'programming': 500,
  'devops': 600,
  'academics': 400,
  'career': 450,
  'business': 550,
  'default': 500
};

/* ================= AUTH STATE ================= */
const token = localStorage.getItem("token");
const role = localStorage.getItem("role");
const storedName = localStorage.getItem("name") || localStorage.getItem("username") || (localStorage.getItem("email") || "").split("@")[0] || null;
const userEmail = localStorage.getItem("email") || null;

console.log('‚úÖ Auth state:', { API_BASE_URL, token: !!token, role, name: storedName, email: userEmail });

/* ================= NAV ================= */
const nav = document.getElementById("nav");

if (token && role) {
  const dashboardUrl = role === 'expert' ? '/expert-dashboard.html' : '/client-dashboard.html';
  nav.innerHTML = `
    <a href="${dashboardUrl}">Dashboard</a>
    <span>üë§ ${storedName}</span>
    <a href="#" onclick="logout(); return false;">Logout</a>
  `;
} else {
  nav.innerHTML = `
    <a href="/login.html" class="cta">Login</a>
    <a href="/signup-client.html">Sign Up</a>
  `;
}

function logout(){
  if (confirm('Are you sure you want to logout?')) {
    localStorage.clear();
    location.href="/login.html";
  }
}

/* ================= LOAD EXPERTS ================= */
let allExperts = [];

async function loadExperts(){
  try{
    console.log('üîÑ Loading experts...');
    const res = await fetch("/api/experts?status=approved");
    
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}: ${res.statusText}`);
    }
    
    allExperts = await res.json();
    console.log('‚úÖ Experts loaded:', allExperts.length);
    
    if (allExperts.length > 0) {
      console.log('üìã Sample expert:', allExperts[0]);
    }
    
    renderExperts(allExperts);
  }catch(err){
    console.error('‚ùå Load error:', err);
    document.getElementById("expertsGrid").innerHTML = `
      <div class="empty">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Unable to load experts</h3>
        <p>Error: ${err.message}</p>
        <p style="margin-top: 12px; font-size: 13px;">Check console (F12) for details</p>
      </div>
    `;
  }
}

function getPhotoUrl(expert) {
  if (!expert.avatar) {
    console.log(`‚ö†Ô∏è No avatar for ${expert.name}`);
    return null;
  }
  
  let photoUrl = '';
  
  if (expert.avatar.includes('uploads/')) {
    photoUrl = `/${expert.avatar}`;
  } 
  else if (!expert.avatar.includes('/')) {
    photoUrl = `/uploads/photos/${expert.avatar}`;
  }
  else {
    photoUrl = `/uploads/${expert.avatar}`;
  }
  
  console.log(`üñºÔ∏è Photo URL for ${expert.name}: ${photoUrl}`);
  return photoUrl;
}

function getExpertPrice(expert) {
  return expert.price || EXPERT_PRICING[expert.field?.toLowerCase()] || EXPERT_PRICING.default;
}

function getDomainIcon(field) {
  const icons = {
    'programming': 'fa-code',
    'devops': 'fa-server',
    'academics': 'fa-graduation-cap',
    'career': 'fa-briefcase',
    'business': 'fa-chart-line'
  };
  return icons[field?.toLowerCase()] || 'fa-star';
}

function renderExperts(list){
  const grid = document.getElementById("expertsGrid");
  
  if (!list.length) {
    grid.innerHTML = `
      <div class="empty">
        <i class="fas fa-users"></i>
        <h3>No experts available</h3>
        <p>No verified professionals found. Please check back later.</p>
      </div>
    `;
    return;
  }

  grid.innerHTML = list.map(expert => {
    const photoUrl = getPhotoUrl(expert);
    const initial = expert.name ? expert.name[0].toUpperCase() : 'E';
    const statusIcon = expert.status === 'approved' ? '‚úì' : '‚è≥';
    const price = getExpertPrice(expert);
    const domainIcon = getDomainIcon(expert.field);
    const joinYear = expert.createdAt ? new Date(expert.createdAt).getFullYear() : new Date().getFullYear();
    
    return `
    <div class="card">
      <!-- Header with Photo -->
      <div class="card-header">
        <div class="avatar-container">
          ${photoUrl ? 
            `<img 
              src="${photoUrl}" 
              alt="${expert.name}" 
              class="avatar" 
              onerror="console.error('‚ùå Failed to load:', '${photoUrl}'); this.style.display='none'; this.nextElementSibling.style.display='flex';"
            >` : ''
          }
          <div class="avatar-fallback" ${photoUrl ? 'style="display:none"' : ''}>
            ${initial}
          </div>
          ${expert.status === 'approved' ? `
          <div class="verified-badge" title="Verified Expert">
            <i class="fas fa-check"></i>
          </div>
          ` : ''}
        </div>
        <div class="card-content">
          <h3>${expert.name || 'Unknown Expert'}</h3>
          <div class="domain">
            <i class="fas ${domainIcon}"></i>
            ${expert.field || "General Expert"}
          </div>
        </div>
      </div>

      <!-- Bio Section -->
      <div class="expert-bio">
        ${expert.headline ? `<div class="headline">${expert.headline}</div>` : ''}
        <div class="desc">
          ${expert.summary || "Experienced professional ready to help you succeed with their expertise and knowledge."}
        </div>
      </div>

      <!-- Enhanced Stats -->
      <div class="stats">
        <div class="stat-item">
          <div class="stat-icon">
            <i class="fas fa-briefcase"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">Experience</div>
            <div class="stat-value">${expert.experience || 0}+ years</div>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="stat-info">
            <div class="stat-label">Since</div>
            <div class="stat-value">${joinYear}</div>
          </div>
        </div>
      </div>

      <!-- LinkedIn Link -->
      ${expert.linkedin ? `
      <div class="expert-links">
        <a href="${expert.linkedin}" target="_blank" class="linkedin-link">
          <i class="fab fa-linkedin"></i>
          View LinkedIn Profile
        </a>
      </div>
      ` : ''}

      <!-- Price Section -->
      <div class="price-section">
        <div>
          <div class="price-label">Consultation Fee</div>
          <div class="price-badge">
            <i class="fas fa-rupee-sign"></i>
            ${price}
          </div>
        </div>
      </div>

      <!-- Connect Button -->
      <button class="connect" onclick='connectExpert(${JSON.stringify(expert).replace(/'/g, "&#39;")})'>
        <i class="fas fa-lock"></i> 
        Pay & Connect Now
      </button>
    </div>
    `;
  }).join('');
}

function filterExperts(type, btn){
  document.querySelectorAll(".filters button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  if (type === "all") {
    renderExperts(allExperts);
  } else {
    const filtered = allExperts.filter(e => 
      e.field?.toLowerCase().includes(type.toLowerCase())
    );
    renderExperts(filtered);
  }
  
  console.log(`üîç Filtered by: ${type}, Results: ${type === 'all' ? allExperts.length : filtered.length}`);
}

/* ================= üí≥ RAZORPAY PAYMENT INTEGRATION ================= */
async function connectExpert(expert){
  if (!token) {
    alert("Please login to connect with an expert.");
    location.href = "/login.html";
    return;
  }
  
  console.log('üîó Initiating payment for expert:', expert.email);
  console.log('üí∞ Expert price:', expert.price || EXPERT_PRICING[expert.field?.toLowerCase()] || EXPERT_PRICING.default);
  
  try {
    document.getElementById('paymentModal').classList.add('active');
    
    console.log('üì§ Creating order...');
    const orderResponse = await fetch(`${API_BASE_URL}/create-order`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        expertEmail: expert.email,
        expertField: expert.field
      })
    });
    
    if (!orderResponse.ok) {
      const errorData = await orderResponse.json();
      throw new Error(errorData.message || 'Failed to create order');
    }
    
    const orderData = await orderResponse.json();
    console.log('‚úÖ Order created:', orderData.orderId);
    console.log('üí≥ Amount:', orderData.amount / 100, 'INR');
    
    document.getElementById('paymentModal').classList.remove('active');
    
    const options = {
      key: orderData.key,
      amount: orderData.amount,
      currency: orderData.currency,
      name: 'SolutionHub',
      description: `Consultation with ${expert.name}`,
      image: '/logo.png',
      order_id: orderData.orderId,
      prefill: {
        name: storedName || '',
        email: userEmail || '',
        contact: ''
      },
      theme: {
        color: '#6366f1'
      },
      handler: async function(response) {
        console.log('üí≥ Payment successful, verifying...');
        console.log('üìã Payment response:', response);
        await verifyPayment(response, expert);
      },
      modal: {
        ondismiss: function() {
          console.log('‚ùå Payment cancelled by user');
          alert('Payment was cancelled. Please try again to connect with the expert.');
        },
        escape: false,
        backdropclose: false
      },
      retry: {
        enabled: true,
        max_count: 3
      }
    };
    
    console.log('üöÄ Opening Razorpay checkout...');
    const razorpay = new Razorpay(options);
    
    razorpay.on('payment.failed', function(response){
      console.error('‚ùå Payment failed:', response.error);
      alert(`Payment failed: ${response.error.description || 'Please try again'}`);
    });
    
    razorpay.open();
    
  } catch (error) {
    console.error('‚ùå Payment initiation error:', error);
    document.getElementById('paymentModal').classList.remove('active');
    alert(`Failed to initiate payment: ${error.message}\n\nPlease check:\n1. Backend server is running\n2. You are logged in\n3. Razorpay keys are configured`);
  }
}

async function verifyPayment(paymentResponse, expert) {
  try {
    document.getElementById('paymentModal').classList.add('active');
    
    console.log('üì§ Verifying payment...');
    console.log('üìã Verification data:', {
      orderId: paymentResponse.razorpay_order_id,
      paymentId: paymentResponse.razorpay_payment_id
    });
    
    const verifyResponse = await fetch(`${API_BASE_URL}/verify-payment`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({
        razorpay_order_id: paymentResponse.razorpay_order_id,
        razorpay_payment_id: paymentResponse.razorpay_payment_id,
        razorpay_signature: paymentResponse.razorpay_signature
      })
    });
    
    const verifyData = await verifyResponse.json();
    
    document.getElementById('paymentModal').classList.remove('active');
    
    if (verifyData.success) {
      console.log('‚úÖ Payment verified successfully');
      console.log('üìã Verification result:', verifyData);
      
      localStorage.setItem('lastPaymentId', verifyData.paymentId);
      localStorage.setItem('lastOrderId', verifyData.orderId);
      
      alert(`üéâ Payment successful!\n\nAmount: ‚Çπ${verifyData.amount}\nPayment ID: ${verifyData.paymentId}\n\nYou can now chat with ${expert.name}`);
      
      location.href = `/book-expert.html?email=${encodeURIComponent(expert.email)}&paymentId=${verifyData.paymentId}`;
      
    } else {
      throw new Error(verifyData.message || 'Payment verification failed');
    }
    
  } catch (error) {
    console.error('‚ùå Verification error:', error);
    document.getElementById('paymentModal').classList.remove('active');
    alert(`Payment verification failed: ${error.message}\n\nPlease contact support with your payment details.`);
  }
}

/* ================= üöÄ AUTO LOAD ON PAGE READY ================= */
window.addEventListener("load", () => {
  console.log('üöÄ Experts page loaded');
  console.log('üîß API Base URL:', API_BASE_URL);
  console.log('üë§ User authenticated:', !!token);
  loadExperts();
});

window.debugPayment = function() {
  console.log('=== PAYMENT DEBUG INFO ===');
  console.log('API URL:', API_BASE_URL);
  console.log('Token:', token ? 'Present ‚úÖ' : 'Missing ‚ùå');
  console.log('User Email:', userEmail);
  console.log('User Name:', storedName);
  console.log('Experts loaded:', allExperts.length);
  console.log('==========================');
};

console.log('üí° Tip: Type debugPayment() in console for debug info');
</script>
</body>
</html>
