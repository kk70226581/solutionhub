<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solvenut | Find Experts</title>

  <!-- Fonts & icons -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Razorpay -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <style>
    :root{
      --brand-1: #10b981;
      --brand-2: #14b8a6;
      --accent: #f59e0b;
      --bg: #0a0f1e;
      --card: rgba(255,255,255,0.04);
      --muted: #94a3b8;
      --text: #f8fafc;
      --success: #10b981;
      --glass: rgba(255,255,255,0.05);
      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-soft: 0 12px 40px rgba(2,6,23,0.6);
      --max-width: 1240px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{
      font-family:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
      scroll-behavior:smooth;
    }
    body{
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      line-height:1.6;
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    a{color:inherit;text-decoration:none}
    button{font-family:inherit}

    .container{max-width:var(--max-width);margin:0 auto;padding:0 20px}

    .ambient-glow{
      position:fixed;inset:0;z-index:-1;pointer-events:none;
      background:
        radial-gradient(circle at 30% 20%, rgba(16,185,129,0.08) 0%, transparent 35%),
        radial-gradient(circle at 70% 80%, rgba(245,158,11,0.06) 0%, transparent 30%);
    }

    /* HEADER */
    header{
      position:sticky;top:0;z-index:1000;
      background:linear-gradient(180deg, rgba(10,15,30,0.92), rgba(10,15,30,0.75));
      backdrop-filter: blur(12px);
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .header-inner{
      display:flex;align-items:center;justify-content:space-between;
      gap:16px;padding:12px 20px;
    }
    .logo{display:flex;align-items:center;gap:10px;cursor:pointer}
    .logo .mark{
      width:36px;height:36px;border-radius:10px;
      background:linear-gradient(135deg,var(--brand-1),var(--brand-2));
      display:grid;place-items:center;color:white;font-weight:900;font-size:18px;
    }
    .logo .txt{font-weight:800;font-size:18px}
    .logo .txt .nut{color:var(--accent)}

    nav.desktop{display:flex;gap:24px;align-items:center}
    nav.desktop a{
      font-weight:600;color:var(--muted);
      padding:6px 10px;border-radius:8px;transition:all .2s;
    }
    nav.desktop a:hover, nav.desktop a.active{
      color:var(--text);background:var(--glass);
    }

    .actions{display:flex;gap:10px;align-items:center}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      padding:9px 16px;border-radius:12px;
      font-weight:700;border:0;cursor:pointer;transition:all .22s;
      text-decoration:none;font-size:14px;
    }
    .btn-primary{
      background:linear-gradient(90deg,var(--brand-1),var(--brand-2));
      color:white;box-shadow:0 8px 32px rgba(16,185,129,0.25);
    }
    .btn-primary:hover{
      transform:translateY(-2px);
      box-shadow:0 12px 48px rgba(16,185,129,0.35);
    }
    .btn-ghost{
      background:transparent;
      border:1px solid rgba(255,255,255,0.1);
      color:var(--text);
    }
    .btn-ghost:hover{
      background:var(--glass);
      border-color:rgba(255,255,255,0.2);
    }

    .nav-user-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 12px;border-radius:999px;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.1);
      color:var(--muted);font-size:13px;max-width:160px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .nav-logout{
      border:0;background:transparent;
      color:#f97373;font-size:12px;cursor:pointer;
    }

    .mobile-toggle{
      display:none;border:0;background:transparent;
      color:var(--text);font-size:22px;cursor:pointer;
    }

    @media(max-width:768px){
      nav.desktop{display:none}
      .mobile-toggle{display:inline-flex}
    }

    .mobile-drawer{
      position:fixed;inset:0;
      background:linear-gradient(180deg, rgba(10,15,30,0.98), rgba(10,15,30,0.95));
      z-index:1500;transform:translateY(-100%);
      transition:transform .3s ease;
      display:flex;flex-direction:column;padding:28px;
      backdrop-filter:blur(8px);
    }
    .mobile-drawer.open{transform:none}
    .mobile-drawer a{
      padding:14px 0;font-size:17px;
      border-bottom:1px solid rgba(255,255,255,0.05);
      color:var(--muted);font-weight:600;
    }

    main{flex:1}

    /* PAGE HERO */
    .page-hero{
      padding:32px 0 20px;
    }
    .page-hero-inner{
      display:flex;justify-content:space-between;
      gap:18px;flex-wrap:wrap;align-items:flex-start;
    }
    .page-hero h1{
      font-size:clamp(26px,4vw,32px);
      font-weight:800;margin-bottom:6px;
    }
    .page-hero p{
      color:var(--muted);font-size:14px;max-width:480px;
    }
    .page-hero-badges{
      display:flex;flex-wrap:wrap;gap:10px;
      font-size:12px;
    }
    .page-hero-badges span{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      background:rgba(15,23,42,0.8);
      border:1px solid rgba(148,163,184,0.35);
      color:var(--muted);
    }
    .page-hero-badges i{color:var(--brand-1)}

    /* FILTERS */
    .filters{
      margin:8px 0 14px;
      display:flex;flex-wrap:wrap;gap:8px;
      font-size:13px;
    }
    .filters-title{
      width:100%;color:var(--muted);margin-bottom:2px;
    }
    .filters button{
      border-radius:999px;border:1px solid rgba(148,163,184,0.4);
      background:rgba(15,23,42,0.8);
      padding:6px 12px;font-size:13px;
      cursor:pointer;color:var(--muted);
      display:inline-flex;align-items:center;gap:6px;
    }
    .filters button.active,
    .filters button:hover{
      background:linear-gradient(90deg,var(--brand-1),var(--brand-2));
      color:white;border-color:transparent;
    }

    /* GRID & CARDS */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(260px,1fr));
      gap:16px;
      padding-bottom:32px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius-md);
      border:1px solid rgba(148,163,184,0.25);
      padding:14px 14px 12px;
      box-shadow:0 10px 30px rgba(15,23,42,0.6);
      display:flex;flex-direction:column;gap:8px;
    }

    .card-header{
      display:flex;gap:10px;align-items:center;
    }
    .avatar{
      width:44px;height:44px;border-radius:50%;
      background:linear-gradient(135deg,var(--brand-1),var(--brand-2));
      display:flex;align-items:center;justify-content:center;
      font-weight:800;color:white;font-size:18px;
      overflow:hidden;flex-shrink:0;
    }
    .avatar img{
      width:100%;height:100%;object-fit:cover;display:block;
    }
    .card-main{flex:1;min-width:0}
    .card-name{
      font-size:15px;font-weight:600;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .card-field{
      font-size:12px;color:var(--accent);margin-top:1px;
    }
    .card-status{
      font-size:11px;color:var(--success);margin-top:2px;
    }

    .card-desc{
      font-size:13px;color:var(--muted);min-height:32px;
    }

    .card-meta{
      display:flex;justify-content:space-between;
      font-size:12px;color:var(--muted);
      gap:6px;flex-wrap:wrap;
    }
    .card-meta span{
      display:inline-flex;align-items:center;gap:4px;
    }

    .card-price-row{
      display:flex;justify-content:space-between;
      align-items:center;font-size:13px;margin-top:2px;
    }
    .card-price{
      font-weight:700;color:var(--brand-1);
    }
    .card-tagline{
      font-size:12px;color:var(--muted);
    }

    .card-cta{margin-top:6px}
    .card-cta button{
      width:100%;
      border-radius:999px;
      border:0;
      padding:8px 0;
      font-size:13px;font-weight:700;
      background:linear-gradient(90deg,var(--brand-1),var(--brand-2));
      color:white;cursor:pointer;
    }
    .card-cta button:disabled{
      opacity:0.6;cursor:not-allowed;
    }

    .empty{
      grid-column:1/-1;
      text-align:center;
      padding:40px 8px;
      color:var(--muted);
      font-size:14px;
    }
    .empty i{
      font-size:30px;margin-bottom:10px;color:var(--accent);
    }

    /* EXTRA INFO SECTIONS */

    .section{
      padding:32px 0;
      border-top:1px solid rgba(148,163,184,0.25);
    }
    .section-header{
      margin-bottom:16px;
    }
    .section-header h2{
      font-size:20px;font-weight:700;
      margin-bottom:4px;
    }
    .section-header p{
      font-size:14px;color:var(--muted);max-width:560px;
    }

    /* Why human experts */
    .why-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;
    }
    .why-card{
      background:var(--card);
      border-radius:var(--radius-md);
      border:1px solid rgba(148,163,184,0.25);
      padding:16px;
      font-size:14px;
      color:var(--muted);
    }
    .why-card h3{
      font-size:15px;margin-bottom:6px;
      color:var(--text);
    }

    /* What you get */
    .benefits-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:8px;
    }
    .benefit-item{
      display:flex;gap:10px;align-items:flex-start;
      font-size:14px;color:var(--muted);
    }
    .benefit-item i{
      color:var(--brand-1);margin-top:2px;
    }

    /* FAQ */
    .faq-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:14px;
      margin-top:8px;
    }
    .faq-item{
      background:var(--card);
      border-radius:var(--radius-md);
      border:1px solid rgba(148,163,184,0.25);
      padding:14px;
      font-size:14px;color:var(--muted);
    }
    .faq-item h3{
      font-size:15px;margin-bottom:6px;color:var(--text);
    }

    /* PAYMENT MODAL */
    .payment-modal{
      position:fixed;inset:0;
      background:rgba(15,23,42,0.7);
      display:none;align-items:center;justify-content:center;
      z-index:2000;
    }
    .payment-modal.active{display:flex}
    .payment-content{
      background:var(--card);
      border-radius:14px;
      padding:18px 18px 16px;
      max-width:320px;width:90%;
      text-align:center;
      border:1px solid rgba(148,163,184,0.4);
      box-shadow:var(--shadow-soft);
      font-size:14px;
    }
    .payment-content i{
      font-size:28px;color:var(--brand-1);
      margin-bottom:8px;
    }

    /* FOOTER */
    footer{
      padding:28px 0 22px;
      border-top:1px solid rgba(255,255,255,0.06);
      background:linear-gradient(180deg, transparent, rgba(10,15,30,0.5));
      font-size:13px;color:var(--muted);
    }
    .footer-row{
      display:flex;justify-content:space-between;
      gap:16px;flex-wrap:wrap;align-items:center;
    }
    .footer-links{display:flex;gap:16px;flex-wrap:wrap;font-size:13px}
    .footer-links a{color:var(--muted)}
    .footer-links a:hover{color:var(--brand-1)}

    @media (prefers-reduced-motion: reduce){
      *{animation:none!important;transition:none!important}
    }
  </style>
</head>
<body>
  <div class="ambient-glow" aria-hidden="true"></div>

  <!-- HEADER -->
  <header>
    <div class="container header-inner">
      <div class="logo" onclick="location.href='index.html'">
        <div class="mark" aria-hidden="true">ðŸ¥œ</div>
        <div class="txt">Solve<span class="nut">nut</span></div>
      </div>

      <nav class="desktop" aria-label="Primary navigation">
        <a href="index.html#categories">Categories</a>
        <a href="index.html#how">How It Works</a>
        <a href="index.html#features">Features</a>
        <a href="experts.html" class="active">Find Experts</a>
      </nav>

      <div class="actions" id="navAuth">
        <!-- JS fills auth state -->
      </div>

      <button class="mobile-toggle" id="mobileToggle" aria-expanded="false" aria-controls="mobileDrawer">
        <i class="fa-solid fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- MOBILE DRAWER -->
  <div id="mobileDrawer" class="mobile-drawer" role="dialog" aria-modal="true" aria-hidden="true" style="display:none">
    <button id="closeDrawer" style="align-self:flex-end;background:transparent;border:0;color:var(--text);font-size:24px;padding:6px;cursor:pointer">
      <i class="fa-solid fa-xmark"></i>
    </button>
    <a href="index.html#categories">Categories</a>
    <a href="index.html#how">How It Works</a>
    <a href="index.html#features">Features</a>
    <a href="experts.html">Find Experts</a>
  </div>

  <!-- MAIN -->
  <main class="container">
    <!-- PAGE HERO -->
    <section class="page-hero">
      <div class="page-hero-inner">
        <div>
          <h1>Find the right expert for your problem</h1>
          <p>Browse verified professionals across medicine, tech, career, finance, and more. Start a microâ€‘consultation in minutes.</p>
        </div>
        <div class="page-hero-badges">
          <span><i class="fa-solid fa-circle-check"></i> Verified humans, not just AI</span>
          <span><i class="fa-solid fa-indian-rupee-sign"></i> Microâ€‘sessions starting â‚¹5/min</span>
          <span><i class="fa-solid fa-bolt"></i> Typical connect time &lt; 5 min</span>
        </div>
      </div>
    </section>

    <!-- FILTERS -->
    <section class="filters">
      <div class="filters-title">Filter by category</div>
      <button class="active" onclick="filterExperts('all', this)">All</button>
      <button onclick="filterExperts('programming', this)">Programming</button>
      <button onclick="filterExperts('devops', this)">DevOps</button>
      <button onclick="filterExperts('academics', this)">Academics</button>
      <button onclick="filterExperts('career', this)">Career</button>
      <button onclick="filterExperts('business', this)">Business</button>
      <button onclick="filterExperts('medical', this)">Medical</button>
    </section>

    <!-- GRID -->
    <section class="grid" id="expertsGrid">
      <div class="empty">
        <i class="fa-solid fa-spinner fa-spin"></i>
        <div>Loading expertsâ€¦</div>
      </div>
    </section>

    <!-- WHY HUMAN EXPERTS -->
    <section class="section">
      <div class="section-header">
        <h2>Why talk to a human expert?</h2>
        <p>AI is great for quick summaries, but real experts understand context, emotion, and consequences before giving you advice.</p>
      </div>
      <div class="why-grid">
        <div class="why-card">
          <h3>Contextâ€‘aware decisions</h3>
          <p>Experts ask followâ€‘up questions, understand your unique situation, and adjust advice accordingly instead of giving generic answers.</p>
        </div>
        <div class="why-card">
          <h3>Accountability & clarity</h3>
          <p>You know who you are talking to, what their background is, and can come back later to the same expert with followâ€‘ups.</p>
        </div>
        <div class="why-card">
          <h3>Emotion & nuance</h3>
          <p>For health, career, money, or relationships, having a human listen and guide you makes a big difference in confidence.</p>
        </div>
      </div>
    </section>

    <!-- WHAT YOU GET -->
    <section class="section">
      <div class="section-header">
        <h2>What you get in every Solvenut session</h2>
        <p>Every consultation on Solvenut follows the same structure so you know exactly what to expect before you pay.</p>
      </div>
      <div class="benefits-grid">
        <div class="benefit-item">
          <i class="fa-solid fa-check-circle"></i>
          <div>
            <strong>Clear problem framing</strong><br>
            The expert first makes sure they fully understand your problem before giving any solution suggestions.
          </div>
        </div>
        <div class="benefit-item">
          <i class="fa-solid fa-check-circle"></i>
          <div>
            <strong>Stepâ€‘byâ€‘step advice</strong><br>
            You get practical next steps, not vague suggestions, so you know exactly what to do after the call or chat.
          </div>
        </div>
        <div class="benefit-item">
          <i class="fa-solid fa-check-circle"></i>
          <div>
            <strong>Saved history</strong><br>
            Your conversation stays in your Solvenut account so you can review or share it later when needed.
          </div>
        </div>
        <div class="benefit-item">
          <i class="fa-solid fa-check-circle"></i>
          <div>
            <strong>Free followâ€‘up message</strong><br>
            After each paid session, you can send at least one followâ€‘up message for clarifications without extra charge.
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="section">
      <div class="section-header">
        <h2>Experts FAQ</h2>
        <p>Common questions people ask before booking their first session on Solvenut.</p>
      </div>
      <div class="faq-grid">
        <div class="faq-item">
          <h3>How are experts verified?</h3>
          <p>Each expert goes through profile screening, ID verification, and manual review of experience, certifications, or portfolio before being approved.</p>
        </div>
        <div class="faq-item">
          <h3>Is Solvenut for emergencies?</h3>
          <p>No. Solvenut is for nonâ€‘emergency questions and guidance. In any emergency, always contact local authorities or emergency services first.</p>
        </div>
        <div class="faq-item">
          <h3>What if I am not satisfied?</h3>
          <p>If your issue was not addressed at all or the session clearly failed, you can raise a support ticket and we will review for partial or full credit.</p>
        </div>
        <div class="faq-item">
          <h3>Can I stay anonymous?</h3>
          <p>Yes. For sensitive topics, you can hide your real name and photo; experts see only what is necessary to help you.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- PAYMENT MODAL -->
  <div class="payment-modal" id="paymentModal">
    <div class="payment-content">
      <i class="fa-solid fa-spinner fa-spin"></i>
      <div>Processing paymentâ€¦</div>
      <div style="margin-top:4px;color:var(--muted);font-size:13px">Please wait a moment.</div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <div class="container footer-row">
      <div>Â© 2026 Solvenut Â· Affordable, humanâ€‘first expert advice</div>
      <div class="footer-links">
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
        <a href="#">Refunds</a>
      </div>
    </div>
  </footer>

  <script>
    const API_BASE_URL = 'http://localhost:3000/api';

    const EXPERT_PRICING = {
      programming: 500,
      devops: 600,
      academics: 400,
      career: 450,
      business: 550,
      medical: 500,
      default: 500
    };

    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role');
    const storedName =
      localStorage.getItem('name') ||
      localStorage.getItem('username') ||
      (localStorage.getItem('email') ? localStorage.getItem('email').split('@')[0] : null);
    const userEmail = localStorage.getItem('email') || null;

    // NAV AUTH
    const navAuth = document.getElementById('navAuth');
    if (token && role) {
      const dashUrl = role === 'expert' ? 'expert-dashboard.html' : 'client-dashboard.html';
      navAuth.innerHTML = `
        <div class="nav-user-pill">
          <i class="fa-regular fa-circle-user"></i>
          <span>${storedName || 'User'}</span>
        </div>
        <a href="${dashUrl}" class="btn btn-ghost" style="font-size:13px;padding:7px 12px">Dashboard</a>
        <button class="nav-logout" onclick="logout()">Logout</button>
      `;
    } else {
      navAuth.innerHTML = `
        <a class="btn btn-ghost" href="login.html">Login</a>
        <a class="btn btn-primary" href="signup-client.html"><i class="fas fa-comment-dots"></i> Ask Expert</a>
      `;
    }

    function logout() {
      if (confirm('Logout from this device?')) {
        localStorage.clear();
        location.href = 'login.html';
      }
    }

    // Mobile drawer
    const mobileToggle = document.getElementById('mobileToggle');
    const mobileDrawer = document.getElementById('mobileDrawer');
    const closeDrawer = document.getElementById('closeDrawer');

    function openDrawer(){
      mobileDrawer.style.display = 'flex';
      setTimeout(()=> mobileDrawer.classList.add('open'), 20);
      mobileDrawer.setAttribute('aria-hidden','false');
      mobileToggle.setAttribute('aria-expanded','true');
    }
    function closeMobile(){
      mobileDrawer.classList.remove('open');
      mobileDrawer.setAttribute('aria-hidden','true');
      mobileToggle.setAttribute('aria-expanded','false');
      setTimeout(()=> mobileDrawer.style.display='none', 300);
    }
    mobileToggle?.addEventListener('click', openDrawer);
    closeDrawer?.addEventListener('click', closeMobile);

    // EXPERT DATA
    let allExperts = [];

    function getPhotoUrl(expert) {
      if (!expert.avatar) return null;
      if (expert.avatar.startsWith('http')) return expert.avatar;
      const base = API_BASE_URL.replace('/api', '');
      const clean = expert.avatar.startsWith('/') ? expert.avatar.slice(1) : expert.avatar;
      if (clean.startsWith('uploads')) return base + '/' + clean;
      return base + '/uploads/' + clean;
    }

    function getPrice(expert) {
      const field = (expert.field || '').toLowerCase();
      return expert.price || EXPERT_PRICING[field] || EXPERT_PRICING.default;
    }

    function renderExperts(list) {
      const grid = document.getElementById('expertsGrid');
      if (!list.length) {
        grid.innerHTML = `
          <div class="empty">
            <i class="fa-regular fa-face-sad-tear"></i>
            <div>No experts found in this category.</div>
          </div>
        `;
        return;
      }

      grid.innerHTML = list.map((expert, index) => {
        const photo = getPhotoUrl(expert);
        const initial = (expert.name || 'E')[0].toUpperCase();
        const price = getPrice(expert);
        const experience = expert.experience || 0;
        const createdYear = expert.createdAt
          ? new Date(expert.createdAt).getFullYear()
          : new Date().getFullYear();

        const id = `exp-${index}`;

        return `
          <article class="card" data-expert-id="${id}">
            <div class="card-header">
              <div class="avatar">
                ${
                  photo
                    ? `<img src="${photo}" alt="${expert.name || 'Expert'}"
                        onerror="this.style.display='none';this.parentElement.textContent='${initial}'">`
                    : initial
                }
              </div>
              <div class="card-main">
                <div class="card-name" title="${expert.name || 'Expert'}">${expert.name || 'Expert'}</div>
                <div class="card-field">${expert.field || 'General Expert'}</div>
                <div class="card-status">Verified</div>
              </div>
            </div>

            <div class="card-desc">
              ${
                expert.headline ||
                expert.summary ||
                'Short, focused session to give you clear, practical guidance.'
              }
            </div>

            <div class="card-meta">
              <span><i class="fa-regular fa-id-badge"></i>${experience}+ yrs exp</span>
              <span><i class="fa-regular fa-calendar"></i>Since ${createdYear}</span>
            </div>

            <div class="card-price-row">
              <div class="card-price">â‚¹${price} / session</div>
              <div class="card-tagline">Free followâ€‘up message</div>
            </div>

            <div class="card-cta">
              <button data-expert-id="${id}"><i class="fa-solid fa-comments"></i> Pay & talk</button>
            </div>
          </article>
        `;
      }).join('');
    }

    function filterExperts(type, btn) {
      document.querySelectorAll('.filters button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      if (type === 'all') {
        renderExperts(allExperts);
      } else {
        const filtered = allExperts.filter(e =>
          (e.field || '').toLowerCase().includes(type.toLowerCase())
        );
        renderExperts(filtered);
      }
    }
    window.filterExperts = filterExperts;

    async function loadExperts() {
      const grid = document.getElementById('expertsGrid');
      try {
        const res = await fetch(`${API_BASE_URL}/experts?status=approved`);
        if (!res.ok) throw new Error('Failed to load experts');
        allExperts = await res.json();
        if (!Array.isArray(allExperts)) allExperts = [];
        renderExperts(allExperts);
      } catch (err) {
        grid.innerHTML = `
          <div class="empty">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <div>Unable to load experts.</div>
            <div style="margin-top:4px;font-size:13px">${err.message}</div>
          </div>
        `;
      }
    }

    // PAYMENT FLOW
    async function connectExpert(expert) {
      if (!token) {
        alert('Please login first.');
        location.href = 'login.html';
        return;
      }

      const modal = document.getElementById('paymentModal');
      try {
        modal.classList.add('active');

        const orderRes = await fetch(`${API_BASE_URL}/create-order`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({
            expertEmail: expert.email,
            expertField: expert.field
          })
        });

        if (!orderRes.ok) throw new Error('Could not create order.');
        const orderData = await orderRes.json();
        modal.classList.remove('active');

        const options = {
          key: orderData.key,
          amount: orderData.amount,
          currency: orderData.currency,
          name: 'Solvenut',
          description: `Consultation with ${expert.name}`,
          order_id: orderData.orderId,
          prefill: {
            name: storedName || '',
            email: userEmail || '',
            contact: ''
          },
          handler: async function(response) {
            await verifyPayment(response, expert);
          }
        };

        const rzp = new Razorpay(options);
        rzp.open();
      } catch (e) {
        modal.classList.remove('active');
        alert('Payment could not start. Please try again.');
      }
    }

    async function verifyPayment(paymentResponse, expert) {
      const modal = document.getElementById('paymentModal');
      try {
        modal.classList.add('active');

        const verifyRes = await fetch(`${API_BASE_URL}/verify-payment`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({
            razorpay_order_id: paymentResponse.razorpay_order_id,
            razorpay_payment_id: paymentResponse.razorpay_payment_id,
            razorpay_signature: paymentResponse.razorpay_signature
          })
        });

        const data = await verifyRes.json();
        modal.classList.remove('active');

        if (!data.success) {
          throw new Error(data.message || 'Verification failed');
        }

        alert(`Payment successful! You can now talk to ${expert.name}.`);
        location.href = `book-expert.html?email=${encodeURIComponent(
          expert.email
        )}&paymentId=${data.paymentId}`;
      } catch (e) {
        modal.classList.remove('active');
        alert('Payment verification failed. Please contact support.');
      }
    }

    // CLICK HANDLER
    document.getElementById('expertsGrid').addEventListener('click', e => {
      const btn = e.target.closest('button[data-expert-id]');
      if (!btn) return;
      const id = btn.getAttribute('data-expert-id');
      if (!id) return;
      const index = parseInt(id.split('-')[1], 10);
      const expert = allExperts[index];
      if (expert) connectExpert(expert);
    });

    // INIT
    window.addEventListener('load', () => {
      loadExperts();
    });
  </script>
</body>
</html>
